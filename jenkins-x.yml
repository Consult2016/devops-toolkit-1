buildPack: go
pipelineConfig:
  agent:
    image: vfarcic/jx-hugo-builder
  pipelines:
    release:
      build:
        replace: true
        steps:
        - name: 1-themes
          command: cd themes && git clone https://github.com/MarcusVirg/forty.git
        - name: 2-hugo
          command: pwd && hugo version && hugo && ls -l /workspace/source/public && cat /workspace/source/public/index.html
        - name: container-build
          command: export VERSION=`cat VERSION` && skaffold build -f skaffold.yaml
        - name: post-build
          command: jx step post build --image $DOCKER_REGISTRY/$ORG/$APP_NAME:\$(cat VERSION)
    pullRequest:
      build:
        replace: true
        steps:
        - name: 1-themes
          command: cd themes && git clone https://github.com/MarcusVirg/forty.git
        - name: 2-hugo
          command: pwd && hugo version && hugo && ls -l /workspace/source/public && cat /workspace/source/public/index.html
        - name: 3456-compile
          command: export VERSION=$PREVIEW_VERSION && skaffold build -f skaffold.yaml
